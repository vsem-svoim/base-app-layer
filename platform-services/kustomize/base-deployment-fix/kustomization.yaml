apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: base-deployment-fix
  annotations:
    config.kubernetes.io/local-config: "true"

resources:
  - deployment-patches.yaml
  - resource-quotas.yaml
  - node-selectors.yaml

patchesStrategicMerge:
  - deployment-resource-patches.yaml

images:
  # Replace non-existent images with working ones
  - name: base/data-collector
    newName: nginx
    newTag: 1.25-alpine
  - name: base/data-connector
    newName: nginx  
    newTag: 1.25-alpine
  - name: base/data-converter
    newName: nginx
    newTag: 1.25-alpine
  - name: base/data-fetch-retry
    newName: busybox
    newTag: 1.36
  - name: base/data-merger
    newName: nginx
    newTag: 1.25-alpine
  - name: base/data-scheduler
    newName: nginx
    newTag: 1.25-alpine

commonLabels:
  deployment-fix: "automated"
  version: "fixed"

replicas:
  # Scale down to minimal replicas for testing
  - name: base-data-ingestion-agent-data-collector
    count: 1
  - name: base-data-ingestion-agent-data-connector
    count: 1
  - name: base-data-ingestion-agent-data-converter
    count: 1
  - name: base-data-ingestion-agent-data-fetch-retry
    count: 1
  - name: base-data-ingestion-agent-data-merger
    count: 1
  - name: base-data-ingestion-agent-data-scheduler
    count: 1