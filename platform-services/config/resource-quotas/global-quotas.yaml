---
apiVersion: v1
kind: ResourceQuota
metadata:
  name: mlflow-resource-quota
  namespace: mlflow
spec:
  hard:
    # Strict limits for ML workloads
    pods: "10"                    # Max 10 MLflow pods
    requests.cpu: "4"
    requests.memory: "8Gi"
    limits.cpu: "8" 
    limits.memory: "16Gi"
    persistentvolumeclaims: "5"
---
# Prevent DaemonSet runaway scaling
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: node-exporter-pdb
  namespace: monitoring
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: prometheus-node-exporter
  maxUnavailable: "20%"  # Limit disruptions
---
# Network policy to prevent unlimited pod creation
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: monitoring-network-policy
  namespace: monitoring
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: monitoring
    - namespaceSelector:
        matchLabels:
          name: kube-system
  egress:
  - to: []  # Allow all egress for now