<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform UI - Service Management Console</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #059669;
            --warning: #d97706;
            --danger: #dc2626;
            --info: #0891b2;
            
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.5;
        }
        
        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section h1 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .nav-tabs {
            display: flex;
            gap: 2rem;
        }
        
        .nav-tab {
            padding: 0.5rem 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-weight: 500;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .nav-tab:hover, .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }
        
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .service-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .service-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .service-info h3 {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }
        
        .service-category {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .service-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .status-dot.warning { background: var(--warning); }
        .status-dot.danger { background: var(--danger); }
        
        .service-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .service-url {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .api-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        
        .api-table th,
        .api-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }
        
        .api-table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .api-table td {
            color: var(--text-secondary);
        }
        
        .api-endpoint {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
            font-size: 0.875rem;
            background: var(--bg-tertiary);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .health-status {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .health-status.healthy {
            background: #dcfce7;
            color: var(--success);
        }
        
        .health-status.unhealthy {
            background: #fecaca;
            color: var(--danger);
        }
        
        .health-status.initializing {
            background: #fef3c7;
            color: var(--warning);
        }
        
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .health-card {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .health-card h4 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .health-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .metric-value {
            font-weight: 600;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-tabs {
                gap: 1rem;
            }
            
            .services-grid, .health-grid {
                grid-template-columns: 1fr;
            }
            
            .api-table {
                font-size: 0.875rem;
            }
            
            .api-table th,
            .api-table td {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <h1>Platform UI</h1>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" onclick="switchTab('applications')">Applications</button>
                <button class="nav-tab" onclick="switchTab('apis')">API Status</button>
                <button class="nav-tab" onclick="switchTab('health')">Health Monitoring</button>
            </nav>
        </div>
    </header>
    
    <main class="main-content">
        <!-- Applications Tab -->
        <div id="applications" class="tab-content active">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">Application Gallery</h2>
            <div class="services-grid">
                <div class="service-card" onclick="openApplication('/argocd/', 'ArgoCD')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>ArgoCD</h3>
                            <div class="service-category">GitOps Platform</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Declarative GitOps continuous delivery platform for Kubernetes
                    </div>
                    <div class="service-url">/argocd/</div>
                </div>

                <div class="service-card" onclick="openApplication('/workflows/', 'Argo Workflows')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Argo Workflows</h3>
                            <div class="service-category">Workflow Engine</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Container-native workflow engine for orchestrating parallel jobs
                    </div>
                    <div class="service-url">/workflows/</div>
                </div>

                <div class="service-card" onclick="openApplication('/vault/', 'HashiCorp Vault')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>HashiCorp Vault</h3>
                            <div class="service-category">Secrets Management</div>
                        </div>
                        <div class="service-status">
                            <span class="status-dot warning"></span>
                            Sealed
                        </div>
                    </div>
                    <div class="service-description">
                        Secure secrets management and data protection platform
                    </div>
                    <div class="service-url">/vault/</div>
                </div>

                <div class="service-card" onclick="openApplication('/kiali/', 'Kiali')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Kiali</h3>
                            <div class="service-category">Service Mesh</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Service mesh observability and configuration management
                    </div>
                    <div class="service-url">/kiali/</div>
                </div>

                <div class="service-card" onclick="openApplication('/airflow/', 'Apache Airflow')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Apache Airflow</h3>
                            <div class="service-category">Workflow Orchestration</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Platform for developing, scheduling and monitoring workflows
                    </div>
                    <div class="service-url">/airflow/</div>
                </div>

                <div class="service-card" onclick="openApplication('/mlflow/', 'MLflow')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>MLflow</h3>
                            <div class="service-category">ML Lifecycle</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Machine learning lifecycle management platform
                    </div>
                    <div class="service-url">/mlflow/</div>
                </div>

                <div class="service-card" onclick="openApplication('/kubeflow', 'Kubeflow')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Kubeflow</h3>
                            <div class="service-category">ML Platform</div>
                        </div>
                        <div class="service-status">
                            <span class="status-dot warning"></span>
                            Initializing
                        </div>
                    </div>
                    <div class="service-description">
                        Machine learning platform for Kubernetes (API server starting up)
                    </div>
                    <div class="service-url">/kubeflow</div>
                </div>

                <div class="service-card" onclick="openApplication('/seldon', 'Seldon Core')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Seldon Core</h3>
                            <div class="service-category">ML Serving</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Kubernetes operator for model serving (CLI management)
                    </div>
                    <div class="service-url">/seldon</div>
                </div>

                <div class="service-card" onclick="openApplication('/superset/', 'Apache Superset')">
                    <div class="service-header">
                        <div class="service-info">
                            <h3>Apache Superset</h3>
                            <div class="service-category">Business Intelligence</div>
                        </div>
                        <div class="service-status">
                            <span class="status-indicator healthy">Online</span>
                        </div>
                    </div>
                    <div class="service-description">
                        Modern business intelligence web application
                    </div>
                    <div class="service-url">/superset/</div>
                </div>
            </div>
        </div>

        <!-- API Status Tab -->
        <div id="apis" class="tab-content">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">API Status</h2>
            <table class="api-table">
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Endpoint</th>
                        <th>Status</th>
                        <th>Response Time</th>
                        <th>Last Check</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>ArgoCD</td>
                        <td><code class="api-endpoint">/argocd/api/v1/version</code></td>
                        <td><span class="health-status healthy">Healthy</span></td>
                        <td>45ms</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>Argo Workflows</td>
                        <td><code class="api-endpoint">/workflows/api/v1/info</code></td>
                        <td><span class="health-status healthy">Healthy</span></td>
                        <td>32ms</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>HashiCorp Vault</td>
                        <td><code class="api-endpoint">/vault/v1/sys/health</code></td>
                        <td><span class="health-status initializing">Sealed</span></td>
                        <td>12ms</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>Apache Airflow</td>
                        <td><code class="api-endpoint">/airflow/api/v1/health</code></td>
                        <td><span class="health-status healthy">Healthy</span></td>
                        <td>78ms</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>MLflow</td>
                        <td><code class="api-endpoint">/mlflow/api/2.0/mlflow/experiments/list</code></td>
                        <td><span class="health-status healthy">Healthy</span></td>
                        <td>156ms</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>Kubeflow</td>
                        <td><code class="api-endpoint">/kubeflow-api/apis/v1beta1/healthz</code></td>
                        <td><span class="health-status initializing">Starting</span></td>
                        <td>-</td>
                        <td>30s ago</td>
                    </tr>
                    <tr>
                        <td>Apache Superset</td>
                        <td><code class="api-endpoint">/superset/api/v1/security/login</code></td>
                        <td><span class="health-status healthy">Healthy</span></td>
                        <td>89ms</td>
                        <td>30s ago</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Health Monitoring Tab -->
        <div id="health" class="tab-content">
            <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 600;">Health Monitoring</h2>
            <div class="health-grid">
                <div class="health-card">
                    <h4>System Resources</h4>
                    <div class="health-metric">
                        <span class="metric-label">CPU Usage</span>
                        <span class="metric-value">23%</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Memory Usage</span>
                        <span class="metric-value">67%</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Disk Usage</span>
                        <span class="metric-value">45%</span>
                    </div>
                </div>

                <div class="health-card">
                    <h4>Platform Services</h4>
                    <div class="health-metric">
                        <span class="metric-label">Total Services</span>
                        <span class="metric-value">9</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Healthy</span>
                        <span class="metric-value" style="color: var(--success)">7</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Issues</span>
                        <span class="metric-value" style="color: var(--warning)">2</span>
                    </div>
                </div>

                <div class="health-card">
                    <h4>Kubernetes Cluster</h4>
                    <div class="health-metric">
                        <span class="metric-label">Nodes</span>
                        <span class="metric-value">3</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Pods</span>
                        <span class="metric-value">47</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Namespaces</span>
                        <span class="metric-value">12</span>
                    </div>
                </div>

                <div class="health-card">
                    <h4>Network</h4>
                    <div class="health-metric">
                        <span class="metric-label">Ingress Status</span>
                        <span class="metric-value" style="color: var(--success)">Healthy</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">Load Balancer</span>
                        <span class="metric-value" style="color: var(--success)">Online</span>
                    </div>
                    <div class="health-metric">
                        <span class="metric-label">SSL Certificates</span>
                        <span class="metric-value" style="color: var(--success)">Valid</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }
        
        function openApplication(url, name) {
            window.open(url, '_blank');
        }
        
        // Service data storage
        let servicesData = {};
        
        // Fetch services data from backend
        async function fetchServicesData() {
            try {
                const response = await fetch('/api/services/status');
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                servicesData = await response.json();
                updateApplicationsTab();
                updateHealthTab();
                return servicesData;
            } catch (error) {
                console.error('Failed to fetch services data:', error);
                return null;
            }
        }
        
        // Update Applications tab with real data
        function updateApplicationsTab() {
            const serviceCards = document.querySelectorAll('#applications .service-card');
            
            serviceCards.forEach(card => {
                const serviceName = card.querySelector('h3').textContent.toLowerCase();
                const serviceKey = findServiceKey(serviceName);
                
                if (serviceKey && servicesData[serviceKey]) {
                    const service = servicesData[serviceKey];
                    const health = service.health;
                    
                    // Update status in service-status div
                    const statusEl = card.querySelector('.status-indicator');
                    if (statusEl) {
                        statusEl.className = `status-indicator ${health.status}`;
                        const statusText = health.status === 'healthy' ? 'Online' : 
                                         health.status === 'warning' ? 'Warning' : 'Error';
                        statusEl.textContent = statusText;
                    }
                    
                    // Update service description with metrics
                    const descEl = card.querySelector('.service-description');
                    if (descEl) {
                        const originalText = descEl.getAttribute('data-original') || descEl.textContent;
                        if (!descEl.getAttribute('data-original')) {
                            descEl.setAttribute('data-original', descEl.textContent);
                        }
                        const metricsText = health.response_time ? 
                            ` | ${health.response_time}ms | ${health.running_pods}/${health.total_pods} pods` : '';
                        descEl.textContent = originalText + metricsText;
                    }
                }
            });
        }
        
        // Update Health tab with real data
        function updateHealthTab() {
            const healthCards = document.querySelectorAll('#health .health-card');
            
            healthCards.forEach(card => {
                const serviceName = card.querySelector('h4').textContent.toLowerCase();
                const serviceKey = findServiceKey(serviceName);
                
                if (serviceKey && servicesData[serviceKey]) {
                    const service = servicesData[serviceKey];
                    const health = service.health;
                    
                    // Update metrics
                    const metrics = card.querySelectorAll('.health-metric .metric-value');
                    if (metrics.length >= 3) {
                        metrics[0].textContent = health.status_code || 'N/A';
                        metrics[1].textContent = health.response_time ? `${health.response_time}ms` : 'N/A';
                        metrics[2].textContent = `${health.running_pods}/${health.total_pods}`;
                        
                        // Update colors based on status
                        metrics[0].style.color = health.status === 'healthy' ? 'var(--success)' : 
                                                health.status === 'warning' ? 'var(--warning)' : 'var(--danger)';
                        metrics[1].style.color = health.response_time < 100 ? 'var(--success)' : 
                                                health.response_time < 500 ? 'var(--warning)' : 'var(--danger)';
                        metrics[2].style.color = health.running_pods === health.total_pods ? 'var(--success)' : 'var(--danger)';
                    }
                }
            });
        }
        
        // Helper function to map display names to service keys
        function findServiceKey(displayName) {
            const mapping = {
                'argocd': 'argocd',
                'airflow': 'airflow',
                'mlflow': 'mlflow', 
                'kubeflow': 'kubeflow',
                'vault': 'vault',
                'superset': 'superset',
                'kiali': 'kiali',
                'workflows': 'workflows'
            };
            
            for (const [key, value] of Object.entries(mapping)) {
                if (displayName.includes(key) || displayName.includes(value)) {
                    return value;
                }
            }
            return null;
        }
        
        // Update timestamps
        function updateTimestamp() {
            const now = new Date();
            const formatted = now.toLocaleString();
            document.querySelectorAll('.timestamp').forEach(el => {
                el.textContent = formatted;
            });
        }
        
        // Initialize
        updateTimestamp();
        fetchServicesData();
        setInterval(updateTimestamp, 60000); // Update every minute
        setInterval(fetchServicesData, 30000); // Update services every 30 seconds
    </script>
</body>
</html>