apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

metadata:
  name: monitoring-stack
  annotations:
    argocd.argoproj.io/sync-wave: "1"

resources:
- manifests/grafana-deployment.yaml
- manifests/prometheus-deployment.yaml

namespace: platform-monitoring

labels:
- includeSelectors: true
  pairs:
  app.kubernetes.io/name: monitoring
  app.kubernetes.io/component: observability
  app.kubernetes.io/part-of: base-platform
  deployment.wave: "1"

patches:
- target:
    kind: Deployment
    name: prometheus
  patch: |-
    - op: replace
      path: /spec/template/spec/nodeSelector
      value:
        eks.amazonaws.com/nodegroup: platform_system