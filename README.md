# Базовая логическая платформа

Корпоративная платформа обработки данных уровня предприятия с 14 специализированными модулями для полного управления жизненным циклом данных от приема до распространения.

## Обзор архитектуры

Платформа предоставляет модульный подход на основе агентов для обработки данных в соответствии с соглашением об именовании: `base-[модуль]-[тип]-[дескриптор]`

## Основные модули

**Обработка данных:**
1. **data_ingestion** - Сбор и прием данных из множественных источников
2. **data_quality** - Обеспечение качества данных и валидация  
3. **feature_engineering** - Расширенная инженерия признаков и понимание данных
4. **data_control** - Плоскость управления и служебные функции
5. **data_storage** - Хранение данных, архивирование и управление жизненным циклом
6. **data_security** - Безопасность, конфиденциальность и соответствие требованиям
7. **data_streaming** - Потоковая обработка данных в режиме реального времени

**Расширенная обработка:**
8. **pipeline_management** - Оркестрация рабочих процессов и управление зависимостями
9. **schema_contracts** - Управление схемами и контрактами
10. **metadata_discovery** - Обнаружение метаданных и отслеживание родословной
11. **multimodal_processing** - Мультимодальная обработка данных (текст, изображения, геопространственные данные)
12. **quality_monitoring** - Мониторинг качества и наблюдаемость
13. **data_distribution** - Распространение данных, API и управление доступом
14. **event_coordination** - Координация на основе событий и шаблоны саг

## Организация файлов

Каждый модуль следует согласованной структуре с шестью основными категориями файлов:

**Агенты** (`agents/`) - Автономные блоки обработки, выполняющие конкретные задачи
- Пример: `base-data-ingestion-agent-data-collector.yaml`
- Назначение: Определение поведения, возможностей и интерфейсов агентов

**Конфигурации** (`configs/`) - Файлы конфигурации, определяющие политики, правила и параметры
- Пример: `base-data-security-config-encryption-standards.yaml`  
- Назначение: Определение операционных параметров и бизнес-правил

**Модели** (`models/`) - Модели машинного обучения и алгоритмы принятия решений
- Пример: `base-data-quality-model-outlier-detection.yaml`
- Назначение: Определение моделей ИИ/МО для интеллектуального принятия решений

**Оркестраторы** (`orchestrators/`) - Компоненты высокоуровневой координации и управления
- Пример: `base-pipeline-management-orchestrator-master-manager.yaml`
- Назначение: Координация множественных агентов и управление сложными рабочими процессами

**Подсказки** (`prompts/`) - Подсказки и инструкции для обработки на основе LLM
- Пример: `base-feature-engineering-prompt-transformer.md`
- Назначение: Определение подсказок для интеллектуальной обработки данных

**Рабочие процессы** (`workflows/`) - Определения сквозных процессов и потоков автоматизации
- Пример: `base-data-streaming-workflow-realtime-processing.yaml`
- Назначение: Определение полных бизнес-процессов и потоков данных

## Основной поток обработки данных

```
Источники необработанных данных
           |
           v
    Прием данных
           |
           v
    Контроль качества
           |
           v  
    Инженерия признаков
           |
           v
    Безопасность
           |
           v
    Хранение
           |
           v
    Распространение
           |
           v
    Конечные пользователи
```

## Полная диаграмма архитектуры

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                       БАЗОВАЯ ЛОГИЧЕСКАЯ ПЛАТФОРМА - Обработка данных               │
└─────────────────────────────────────────────────────────────────────────────────────┘
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        Источники данных: Откуда приходит информация                │
├────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                │
│  │     API     │  │ Базы данных │  │    Файлы    │  │   Потоки    │                │
│  │    REST     │  │  SQL/NoSQL  │  │  CSV/JSON   │  │   Kafka     │                │
│  │   GraphQL   │  │   MongoDB   │  │   Parquet   │  │  Kinesis    │                │
│  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘  └──────┬──────┘                │
│         │                │                │                │                        │
│         └────────────────┼────────────────┼────────────────┘                        │
│                          │                │                                         │
│                          ▼                ▼                                         │
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                    МОДУЛЬ DATA_INGESTION                                       │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐         │ │
│  │  │  Сборщик     │ │ Соединитель  │ │ Конвертер    │ │ Планировщик  │         │ │
│  │  │   Агент      │ │    Агент     │ │    Агент     │ │    Агент     │         │ │
│  │  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘         │ │
│  │         │                │                │                │                 │ │
│  │         └────────────────┼────────────────┼────────────────┘                 │ │
│  │                          │                │                                  │ │
│  │                          ▼                ▼                                  │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │              ОРКЕСТРАТОР ПРИЕМА                                         │ │ │
│  │  │  • Управление API    • Пакетная обработка   • Управление потоками        │ │ │
│  │  │  • Управление файлами • Логика повторов     • Обнаружение источников     │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘

## Детальная структура модуля DATA_INGESTION

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                       ПОЛНАЯ СТРУКТУРА DATA_INGESTION                              │
└─────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                  АГЕНТЫ                                           │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │  Сборщик     │ │ Соединитель  │ │ Конвертер    │ │ Планировщик  │             │
│  │   данных     │ │   данных     │ │   форматов   │ │   задач      │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • Извлечение    • Подключение   • Преобразование • Управление                    │
│    из источников   к API/БД       форматов данных   расписанием                   │
│  • Мониторинг    • Аутентификация • JSON↔CSV↔XML   • Приоритезация               │
│    изменений      • Retry логика   • Валидация     • Распределение                │
│  • Фильтрация    • Пулинг         • Нормализация  • Балансировка                 │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                               КОНФИГУРАЦИИ                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │   Правила    │ │   Политики   │ │   Параметры  │ │ Настройки    │             │
│  │  валидации   │ │ безопасности │ │  подключений │ │ мониторинга  │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • Схемы данных  • Шифрование    • URL эндпоинтов • Метрики SLA                  │
│  • Обязательные  • Права доступа • Таймауты       • Алерты                       │
│    поля           • Аудит логи    • Ретрай лимиты  • Дашборды                    │
│  • Типы данных   • Маскирование  • Пулы соединений • Логирование                 │
│  • Ограничения   • Compliance    • Буферизация    • Производительность           │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                 МОДЕЛИ                                            │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │ Детекторы    │ │ Классификат. │ │ Предикторы   │ │ Оптимизаторы │             │
│  │  аномалий    │ │   данных     │ │  качества    │ │ производит.  │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • ML алгоритмы  • Определение   • Оценка качества • Настройка                   │
│    для выбросов   типов данных    входящих данных   производительности            │
│  • Статистический• Автотегирование• Прогноз ошибок • Автомасштабирование         │
│    анализ         • Сегментация   • Скоринг данных • Оптимизация                 │
│  • Паттерн       • Кластеризация • Метрики качества • Управление                  │
│    распознавание  • Классы данных • Тренды качества  ресурсами                   │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                               ОРКЕСТРАТОРЫ                                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │ Главный      │ │ Координатор  │ │ Балансировщик│ │ Контроллер   │             │
│  │ диспетчер    │ │   потоков    │ │  нагрузки    │ │   ошибок     │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • Управление    • Синхронизация • Распределение  • Обработка                    │
│    всеми агентами  параллельных    нагрузки между   исключений                    │
│  • Планирование  • Координация    • Мониторинг     • Retry стратегии             │
│    задач          зависимостей      производительн. • Логирование                │
│  • Приоритизация • Управление     • Автоскейлинг  • Уведомления                 │
│  • Мониторинг    • Checkpoints    • Throttling     • Recovery                    │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                ПОДСКАЗКИ                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │ Инструкции   │ │   Шаблоны    │ │ Руководства  │ │ Сообщения    │             │
│  │    для ИИ    │ │  обработки   │ │ пользователя │ │  об ошибках  │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • Промпты для   • Стандартные   • Документация   • Текстовые                    │
│    LLM моделей    алгоритмы        по API           сообщения                     │
│  • Context       • Бизнес логика • Примеры        • Коды ошибок                  │
│    формирование   • Правила       • Использования • Рекомендации                 │
│  • Few-shot      • Валидации     • Troubleshooting• Интернационализация          │
│    примеры        • Трансформации • FAQ            • Локализация                 │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            РАБОЧИЕ ПРОЦЕССЫ                                       │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐             │
│  │ Полные       │ │ Бизнес-      │ │ Процедуры    │ │ Автоматизац. │             │
│  │ процессы     │ │ логика       │ │ восстановл.  │ │   задач      │             │
│  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘             │
│  • End-to-end    • Условная      • Rollback       • Cron планировщик             │
│    процессы       логика          операций          • Триггеры событий            │
│  • DAG           • Бизнес правила • Compensation   • Автопочинка                  │
│    определения    • Валидации      • Circuit breaker• Мониторинг                 │
│  • Шаги          • Условные       • Резервное      • Эскалация                   │
│    выполнения     переходы         копирование      • Уведомления                │
└─────────────────────────────────────────────────────────────────────────────────────┘

                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                             УРОВЕНЬ 2: ВАЛИДАЦИЯ                                   │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                      МОДУЛЬ DATA_QUALITY                                       │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐         │ │
│  │  │ Валидатор    │ │  Очиститель  │ │   Аудитор    │ │ Дедупликатор │         │ │
│  │  │   Агент      │ │    Агент     │ │    Агент     │ │    Агент     │         │ │
│  │  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘         │ │
│  │         │                │                │                │                 │ │
│  │  ┌──────▼───────┐ ┌──────▼───────┐ ┌──────▼───────┐ ┌──────▼───────┐         │ │
│  │  │Валидация схем│ │Обнаружение   │ │Оценка качест │ │ Сопоставление│         │ │
│  │  │   Модель     │ │выбросов Мдл  │ │ва Модель     │ │дубликатов Мдл│         │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘         │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
                                          │
                                          ▼
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        УРОВЕНЬ 3: ИНЖЕНЕРИЯ ПРИЗНАКОВ                             │
├─────────────────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────────────────────────┐ │
│  │                   МОДУЛЬ FEATURE_ENGINEERING                                   │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐         │ │
│  │  │Преобразователь│ │  Обогатитель │ │Категоризатор │ │ Разметчик    │         │ │
│  │  │    Агент     │ │    Агент     │ │    Агент     │ │   Агент      │         │ │
│  │  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘ └──────┬───────┘         │ │
│  │         │                │                │                │                 │ │
│  │  ┌──────▼───────┐ ┌──────▼───────┐ ┌──────▼───────┐ ┌──────▼───────┐         │ │
│  │  │Извлечение    │ │Вывод связей  │ │Обнаружение   │ │Автоматическая│         │ │
│  │  │признаков Мдл │ │   Модель     │ │категорий Мдл │ │разметка Мдл  │         │ │
│  │  └──────────────┘ └──────────────┘ └──────────────┘ └──────────────┘         │ │
│  │                                                                               │ │
│  │  ┌─────────────────────────────────────────────────────────────────────────┐ │ │
│  │  │                    MULTIMODAL_PROCESSING                                │ │ │
│  │  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐     │ │ │
│  │  │  │ Процессор   │ │ Процессор   │ │Процессор    │ │Процессор    │     │ │ │
│  │  │  │ документов  │ │ медиаданных │ │геопростр.   │ │врем. рядов  │     │ │ │
│  │  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘     │ │ │
│  │  └─────────────────────────────────────────────────────────────────────────┘ │ │
│  └─────────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Потоковая обработка в реальном времени

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                        ПОТОК ОБРАБОТКИ В РЕАЛЬНОМ ВРЕМЕНИ                          │
└─────────────────────────────────────────────────────────────────────────────────────┘

Источники событий (Kafka, Kinesis, WebSockets)
                     │
                     ▼
         ┌─────────────────────┐
         │  DATA_STREAMING     │
         │  • Маршрутизатор    │◄──────────┐
         │    событий          │           │
         │  • Процессор потока │           │
         │  • Агрегатор        │           │
         │  • Контроль         │           │
         │    противодавления  │           │
         └─────────────────────┘           │
                     │                     │
                     ▼                     │
         ┌─────────────────────┐           │
         │ MULTIMODAL_PROC     │           │
         │ • Анализ в реальном │           │
         │   времени           │           │
         │ • OCR документов    │           │
         │ • Обработка         │           │
         │   изображений       │           │
         │ • Геопространств.   │           │
         │   данные            │           │
         └─────────────────────┘           │
                     │                     │
                     ▼                     │
         ┌─────────────────────┐           │
         │ QUALITY_MONITORING  │           │
         │ • Обнаружение       │───────────┘ [Обратная связь]
         │   аномалий          │
         │ • Мониторинг дрейфа │
         │ • Оповещения в      │
         │   реальном времени  │
         │ • Мониторинг SLA    │
         └─────────────────────┘
                     │
                     ▼
         ┌─────────────────────┐
         │ EVENT_COORDINATION  │
         │ • Источник событий  │
         │ • Шаблоны саг       │
         │ • Очередь неуд.     │
         │   сообщений         │
         │ • Преобразование    │
         │   событий           │
         └─────────────────────┘
                     │
                     ▼
         ┌─────────────────────┐
         │ ВЫХОД В РЕАЛ. ВРЕМ. │
         │ • Живые панели      │
         │ • Потоки событий    │
         │ • Оповещения        │
         │ • API реального     │
         │   времени           │
         └─────────────────────┘
```

## Архитектурные особенности

**Kubernetes-ориентированный дизайн** - Пользовательские CRD и Kubernetes-нативная архитектура
**Архитектура микросервисов на основе событий** - Событийно-управляемые взаимодействия
**Комплексная агентная и оркестраторная платформа** - Модульные компоненты с четкими интерфейсами  
**Интеграция МО/ИИ** - Шаблоны подсказок и модели машинного обучения
**Корпоративная безопасность** - Шифрование, классификация и контроль доступа
**Мониторинг качества** - Обнаружение аномалий, дрейфа и SLA

## Шаблоны использования

**Стандартный поток обработки данных:**
1. Прием → сбор данных через рабочие процессы data_ingestion  
2. Валидация → агенты data_quality обеспечивают целостность данных
3. Преобразование → feature_engineering улучшает и структурирует данные
4. Защита → data_security применяет меры защиты
5. Хранение → data_storage сохраняет с управлением жизненным циклом
6. Мониторинг → quality_monitoring отслеживает производительность
7. Распространение → data_distribution предоставляет доступ через API

**Обработка на основе событий:**
1. Триггер → event_coordination инициирует рабочие процессы
2. Поток → data_streaming обрабатывает данные в реальном времени  
3. Оркестрация → pipeline_management координирует сложные потоки
4. Контроль → data_control мониторит и управляет выполнением

## Соглашения об именовании

Шаблон: `base-[модуль]-[тип]-[дескриптор].[расширение]`

Примеры:
- `base-data-ingestion-agent-data-collector.yaml`
- `base-data-quality-config-validation-rules.yaml`  
- `base-feature-engineering-model-feature-extraction.yaml`
- `base-pipeline-management-orchestrator-master-manager.yaml`
- `base-data-streaming-workflow-realtime-processing.yaml`

## Технические характеристики

**14 специализированных модулей обработки данных**  
**200+ файлов конфигурации и определений**
**Стандартизированное соглашение об именовании**
**Модульная архитектура с четким разделением обязанностей**
**Поддержка пакетной обработки и обработки в реальном времени**  
**Комплексный мониторинг, безопасность и обеспечение качества**

## Дерево принятия решений и логика взаимодействия компонентов

### Дерево принятия решений обработки данных

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                       ДЕРЕВО ПРИНЯТИЯ РЕШЕНИЙ ОБРАБОТКИ ДАННЫХ                     │
└─────────────────────────────────────────────────────────────────────────────────────┘

    Входящие данные
         │
         ▼
    ┌─────────────┐
    │ Тип источн. │
    │   данных?   │
    └─────────────┘
         │
    ┌────┼─────┐
    │    │     │
    ▼    ▼     ▼
┌──────┐ ┌──────┐ ┌──────┐
│ API  │ │Файловые│ │Поток │
│данные│ │ данные │ │данные│
└──┬───┘ └──┬───┘ └──┬───┘
   │        │        │
   ▼        ▼        ▼
┌─────────────────────────┐
│    АГЕНТ ПРИЕМА         │
│  • Агент сборщика       │
│  • Агент соединителя    │
│  • Агент конвертера     │
└─────────────────────────┘
   │
   ▼
┌─────────────┐
│Размер данных│
└─────────────┘
   │
┌──┼──┐
│  │  │
▼  ▼  ▼
┌────────┐ ┌────────┐ ┌────────┐
│< 100МБ │ │100МБ-  │ │> 10ГБ │
│Пакетная│ │10ГБ    │ │Потоков │
│обработка│ │Чанки   │ │обработк│
└────┬───┘ └────┬───┘ └────┬───┘
     │          │          │
     └──────────┼──────────┘
                │
                ▼
    ┌─────────────────────┐
    │  ПРОВЕРКА КАЧЕСТВА  │
    │  • Валидация схемы? │
    │  • Полнота данных?  │
    │  • Правильн. формат?│
    └─────────────────────┘
                │
    ┌───────────┼───────────┐
    │           │           │
    ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│ ПРОЙДЕНО│ │ ОШИБКА  │ │ЧАСТИЧНО │
└─────────┘ └─────────┘ └─────────┘
    │           │           │
    ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐
│Продолжить│ │Отклонить│ │Очистить │
│к след.   │ │и уведом.│ │и повтор.│
│этапу     │ │         │ │         │
└─────────┘ └─────────┘ └─────────┘
    │
    ▼
┌─────────────────────┐
│ИНЖЕНЕРИЯ ПРИЗНАКОВ  │
│ • Преобразовать?    │
│ • Обогатить?        │
│ • Категоризировать? │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│  ПРОВЕРКА БЕЗОПАСН. │
│ • Содержит ПДн?     │
│ • Классификация?    │
│ • Уровень доступа?  │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ РЕШЕНИЕ О ХРАНЕНИИ  │
│ • Горячее/теплое/   │
│   холодное?         │
│ • Репликация?       │
│ • Разделение?       │
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│   РАСПРОСТРАНЕНИЕ   │
│ • Конечная точка API│
│ • Стратегия кэширов.│
│ • Контроль доступа? │
└─────────────────────┘
```

### Матрица взаимодействия компонентов

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                       МАТРИЦА ВЗАИМОДЕЙСТВИЯ КОМПОНЕНТОВ                           │
└─────────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────────────────────────┐
                    │                   ОРКЕСТРАТОРЫ                          │
                    │  ┌──────────────────────────────────────────────────┐   │
                    │  │            Главный контроллер                   │   │
                    │  │  • Координация рабочих процессов                 │   │
                    │  │  • Управление ресурсами                          │   │
                    │  │  • Обработка ошибок                              │   │
                    │  └──────────────────────────────────────────────────┘   │
                    └─────────────────────────────────────────────────────────┘
                                    │           │           │
                          ┌─────────┘           │           └─────────┐
                          │                     │                     │
                          ▼                     ▼                     ▼
        ┌─────────────────────────┐  ┌─────────────────────────┐  ┌─────────────────────────┐
        │       АГЕНТЫ            │  │       МОДЕЛИ            │  │   РАБОЧИЕ ПРОЦЕССЫ      │
        │  ┌─────────────────────┐ │  │  ┌─────────────────────┐ │  │  ┌─────────────────────┐ │
        │  │ • Сборщик данных    │ │  │  │ • Модели МО         │ │  │  │ • Потоки процессов  │ │
        │  │ • Валидатор качества│ │  │  │ • Деревья решений   │ │  │  │ • Бизнес-правила    │ │
        │  │ • Защита безопасн.  │ │  │  │ • Сопоставление     │ │  │  │ • Шаги интеграции   │ │
        │  │ • Процессор потоков │ │  │  │   шаблонов          │ │  │  │ • Восстановление    │ │
        │  │                     │ │  │  │ • Детектор аномалий │ │  │  │   от ошибок         │ │
        │  └─────────────────────┘ │  │  └─────────────────────┘ │  │  └─────────────────────┘ │
        └─────────────────────────┘  └─────────────────────────┘  └─────────────────────────┘
                    │                            │                            │
                    └────────────────────────────┼────────────────────────────┘
                                                 │
                                                 ▼
                    ┌─────────────────────────────────────────────────────────┐
                    │                   КОНФИГУРАЦИИ                          │
                    │  ┌──────────────────────────────────────────────────┐   │
                    │  │  • Бизнес-правила     • Политики безопасности    │   │
                    │  │  • Параметры обработки • Пороги качества         │   │
                    │  │  • Политики хранения  • Настройки мониторинга    │   │
                    │  └──────────────────────────────────────────────────┘   │
                    └─────────────────────────────────────────────────────────┘
                                                 │
                                                 ▼
                    ┌─────────────────────────────────────────────────────────┐
                    │                   ПОДСКАЗКИ                             │
                    │  ┌──────────────────────────────────────────────────┐   │
                    │  │  • Инструкции ИИ      • Подсказки LLM           │   │
                    │  │  • Логика обработки   • Руководящие принципы    │   │
                    │  │  • Сообщения об       • Коммуникации с          │   │
                    │  │    ошибках             пользователями           │   │
                    │  └──────────────────────────────────────────────────┘   │
                    └─────────────────────────────────────────────────────────┘
```

### Архитектурный поток на основе событий

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                      АРХИТЕКТУРНЫЙ ПОТОК НА ОСНОВЕ СОБЫТИЙ                         │
└─────────────────────────────────────────────────────────────────────────────────────┘

    ┌─────────────┐         ┌─────────────┐         ┌─────────────┐
    │ ПРОИЗВОДИТЕЛЬ│ Триггер │ МАРШРУТИЗАТ.│ Маршрут │ ПОТРЕБИТЕЛЬ │
    │  СОБЫТИЙ    │────────▶│   СОБЫТИЙ   │────────▶│  СОБЫТИЙ    │
    │             │         │             │         │             │
    └─────────────┘         └─────────────┘         └─────────────┘
           │                        │                        │
           │                        ▼                        │
           │              ┌─────────────────────┐             │
           │              │ КООРДИНАТОР СОБЫТИЙ │             │
           │              │  • Шаблоны саг      │             │
           │              │  • Управление       │             │
           │              │    транзакциями     │             │
           │              │  • Восстановление   │             │
           │              │    от ошибок        │             │
           │              └─────────────────────┘             │
           │                        │                        │
           └────────────┐            │            ┌──────────┘
                        │            ▼            │
                        │  ┌─────────────────────┐ │
                        │  │ ОЧЕРЕДЬ НЕУДАЧНЫХ   │ │
                        │  │     СООБЩЕНИЙ       │ │
                        │  │  • Неудачные        │ │
                        │  │    события          │ │
                        │  │  • Логика повторов  │ │
                        │  │  • Анализ ошибок    │ │
                        │  └─────────────────────┘ │
                        │            │            │
                        │            ▼            │
                        │  ┌─────────────────────┐ │
                        └─▶│ ПРЕОБРАЗОВАТЕЛЬ     │◀┘
                           │     СОБЫТИЙ         │
                           │  • Преобразование   │
                           │    формата          │
                           │  • Обогащение       │
                           │    данных           │
                           │  • Сопоставление    │
                           │    схем             │
                           └─────────────────────┘
                                      │
                                      ▼
                           ┌─────────────────────┐
                           │  ИСТОЧНИК СОБЫТИЙ   │
                           │  • Хранилище        │
                           │    событий          │
                           │  • История событий  │
                           │  • Восстановление   │
                           │    состояния        │
                           └─────────────────────┘
```

Архитектура поддерживает полный жизненный цикл данных от приема до распространения с корпоративными возможностями безопасности, соответствия требованиям и мониторинга качества.

---

## Развертывание AWS GitOps

### Архитектура развертывания
- **Terraform** - Infrastructure as Code для multicloud
- **Crossplane** - Kubernetes-native Infrastructure as Code
- **Argo Workflows** - замена custom workflow engine
- **Argo Events** - автоматизация на основе событий  
- **Seldon Core** - serving ML моделей
- **MLflow** - управление жизненным циклом ML
- **Kustomize** - конфигурации для окружений
- **ArgoCD ApplicationSets** - автоматизированные волны развертывания
- **Prometheus + Grafana** - мониторинг
- **Airflow** - оркестрация бизнес-процессов

### Multicloud Infrastructure as Code
```
Terraform модули:
├── AWS → EKS, VPC, IAM, RDS, S3
├── Azure → AKS, VNET, AAD, CosmosDB, Storage
├── GCP → GKE, VPC, IAM, CloudSQL, GCS
└── Multicloud → DNS, CDN, Monitoring
```

### Структура проектов ArgoCD
```
base-layer → ссылки на data_ingestion/ папки
ml-apps → MLflow, Seldon Core, Kubeflow  
workflow-apps → Airflow, Argo Workflows
monitoring-apps → Prometheus + Grafana
orchestration-apps → Crossplane + AWS Provider
```

### Быстрое развертывание

**Infrastructure as Code + GitOps:**
```bash
# AWS развертывание с Terraform + ArgoCD
./stage2-aws-provider.sh --region us-east-1

# Multicloud развертывание
terraform -chdir=platform-services/terraform/environments/dev plan
terraform -chdir=platform-services/terraform/environments/dev apply

# Crossplane Infrastructure as Code
kubectl apply -f platform-services/crossplane/compositions/
```

---

## Поэтапное тестирование

### Этап 1: Валидация инфраструктуры
```bash
# Проверка подключения
aws sts get-caller-identity
kubectl cluster-info

# Проверка Terraform конфигураций
ls platform-services/terraform/environments/dev/
cat platform-services/terraform/environments/dev/terraform.tfvars

# Проверка существующих конфигураций
ls data_ingestion/
ls platform-services/argocd/applications/base-layer/
ls platform-services/crossplane/
```

### Этап 2: Применение ApplicationSets
```bash
# Развертывание автоматизированных ApplicationSets
kubectl apply -f platform-services/argocd/applicationsets/automated-platform-deployment.yaml

# Проверка статуса
kubectl get applicationsets -n argocd
kubectl get applications -n argocd | grep automated
```

### Этап 3: Мониторинг развертывания
```bash
# Проверка всех приложений по проектам
kubectl get applications -n argocd -o custom-columns=NAME:.metadata.name,PROJECT:.spec.project,SYNC:.status.sync.status,HEALTH:.status.health.status

# Проверка namespace
kubectl get namespaces | grep -E "(base-data-ingestion|mlflow|seldon|airflow|monitoring|crossplane)"
```

### Этап 4: Проверка data_ingestion ссылок
```bash
# Валидация AWS overlays
kubectl get configmap -n base-data-ingestion data-ingestion-aws-config -o yaml

# Проверка AWS labels на pods
kubectl get pods -n base-data-ingestion -l cloud.provider=aws --show-labels
```

### Этап 5: Доступ к сервисам
```bash
# ArgoCD
kubectl port-forward svc/argocd-server -n argocd 8080:443

# MLflow
kubectl port-forward svc/mlflow -n mlflow 5000:5000

# Airflow  
kubectl port-forward svc/airflow-webserver -n airflow 8081:8080
```

### Этап 6: Проверка работы ApplicationSets
```bash
# Принудительная синхронизация если нужно
kubectl patch application crossplane-core-aws-automated -n argocd -p '{"operation":{"sync":{}}}' --type merge

# Проверка автоматизации
kubectl describe applicationset automated-platform-deployment -n argocd
```

### Критерии успеха
- **Infrastructure as Code**: Terraform создал EKS кластер и инфраструктуру
- **Crossplane**: AWS провайдеры установлены и работают
- **ApplicationSets**: создают приложения автоматически
- **GitOps**: все automated приложения в статусе Synced/Healthy
- **Data Ingestion**: data_ingestion/ папки корректно подключены
- **Multicloud**: AWS overlays применены (labels cloud.provider=aws)
- **ArgoCD**: проекты правильно назначены
- **Services**: доступ к ArgoCD, MLflow, Airflow работает

### Устранение проблем
```bash
# Terraform инфраструктура
terraform -chdir=platform-services/terraform/environments/dev refresh
terraform -chdir=platform-services/terraform/environments/dev plan

# Crossplane провайдеры
kubectl get providers.pkg.crossplane.io
kubectl logs -n crossplane-system deployment/crossplane-aws-provider

# Если приложения в статусе Unknown
kubectl get applications -n argocd | grep Unknown
kubectl patch application <app-name> -n argocd -p '{"operation":{"sync":{}}}' --type merge

# Проверка ошибок GitOps
kubectl describe application <app-name> -n argocd

# Multicloud проверка
kubectl get configmap -A | grep -E "(aws|azure|gcp)"
kubectl get pods -A -l cloud.provider

# Пересоздание ApplicationSet при необходимости
kubectl delete applicationset automated-platform-deployment -n argocd
kubectl apply -f platform-services/argocd/applicationsets/automated-platform-deployment.yaml
```